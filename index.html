<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TV DIGITAL EN VIVO</title>
  <link rel="stylesheet" href="stile.css" />
  <link rel="manifest" href="manifest.json" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    .video-container video:fullscreen {
      width: 100vw;
      height: 100vh;
      object-fit: contain;
    }
  </style>
</head>
<body>
  <header>
    <div class="top-bar">
      <div class="logo"> TV DIGITAL EN VIVO</div>
      <button class="menu-toggle" onclick="toggleMenu()">☰</button>
    </div>
    <nav class="canales">
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/utv/chunks.m3u8')">UTV</a>
      <a onclick="cargarCanal('https://live-evg4.tv360.bitel.com.pe/oQNeTbDAAY1z-3ZZm8mwiA/1748226630/bitel/americatv/bitel/americatv_ori_480p/chunks.m3u8')">AMÉRICA TV</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/panamericana/bitel/panamericana_ori_480p/chunks.m3u8')">PANAMERICANA TV</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/latina/bitel/latina_ori_480p/chunks.m3u8')">LATINA</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/atv/bitel/atv_ori_480p/chunks.m3u8')">ATV</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/fmhmovies/chunks.m3u8')">FMH MOVIES</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/fmhkids/chunks.m3u8')">FMH KIDS</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/bnb/chunks.m3u8')">BNB</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/ribere%C3%B1a/chunks.m3u8')">RIBEREÑA</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/ucayalitv/chunks.m3u8')">UCAYALI TV</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/creolatino/chunks.m3u8')">CREO LATINO</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/creokids/chunks.m3u8')">CREO LATINO KIDS</a>
      <a onclick="cargarCanal('https://live-evg25.tv360.bitel.com.pe/bitel/global/bitel/global_ori_480p/chunks.m3u8')">GLOBAL TV</a>
    </nav>
  </header>

  <main>
    <section class="hero">
      <h1>Disfruta de tv  en vivo</h1>
      <p>Transmisiones en directo de tus canales  favoritos.</p>
    </section>

    <div class="video-container">
      <video id="videoPlayer" controls autoplay playsinline></video>
    </div>

    <div class="controls">
      <button onclick="fullscreen()">Pantalla Completa</button>
      <button onclick="activarPiP()">Ventana Flotante</button>
    </div>
  </main>

  <footer>
    <p>© 2025 TV DIGITAL EN VIVO - Transmisiones en vivo</p>
  </footer>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(reg => console.log('Service Worker registrado', reg))
        .catch(err => console.error('Error al registrar SW', err));
    }

    function cargarCanal(url) {
      const container = document.querySelector('.video-container');

      if (url.endsWith('.m3u8')) {
        container.innerHTML = `<video id="videoPlayer" controls autoplay playsinline muted></video>`;
        const video = document.getElementById('videoPlayer');

        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(url);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, function () {
            video.play();
          });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = url;
        }

        video.muted = true;
        video.play().catch(err => {
          console.warn('Autoplay fue bloqueado:', err);
        });

      } else {
        container.innerHTML = `
          <iframe src="${url}&autoplay=1" allowfullscreen width="100%" height="500px" frameborder="0" allow="autoplay"></iframe>`;
      }

      const nav = document.querySelector('nav.canales');
      if (window.innerWidth <= 768 && nav.classList.contains('visible')) {
        nav.classList.add('hide-up');
        setTimeout(() => {
          nav.classList.remove('visible');
          nav.classList.remove('hide-up');
        }, 400);
      }
    }

    function fullscreen() {
      const container = document.querySelector('.video-container');
      if (container.requestFullscreen) {
        container.requestFullscreen();
      } else if (container.webkitRequestFullscreen) {
        container.webkitRequestFullscreen();
      }
    }

    function activarPiP() {
      const video = document.getElementById('videoPlayer');
      if (document.pictureInPictureEnabled && !video.disablePictureInPicture) {
        if (document.pictureInPictureElement) {
          document.exitPictureInPicture();
        } else {
          video.requestPictureInPicture()
            .catch(error => console.error('Error al activar PiP:', error));
        }
      } else {
        alert("Tu navegador no soporta modo ventana flotante.");
      }
    }

    function toggleMenu() {
      const nav = document.querySelector('nav.canales');
      nav.classList.toggle('visible');
    }

    window.addEventListener('orientationchange', () => {
      const video = document.getElementById('videoPlayer');
      if (window.innerWidth <= 768 && window.innerHeight > window.innerWidth) {
        if (video.requestFullscreen) {
          video.requestFullscreen().then(() => {
            if (screen.orientation && screen.orientation.lock) {
              screen.orientation.lock('landscape').catch(err => {
                console.warn('No se pudo bloquear orientación:', err);
              });
            }
          });
        }
      }
    });
  </script>
</body>
</html>
